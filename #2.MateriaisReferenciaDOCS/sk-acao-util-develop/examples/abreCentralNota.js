"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var mensagem;function App(){var t={query:null,start:function(e){t.query=new Query,e(t),t.query.close()},selection:function(e){if(e)return new Record(linhas[0]);var r=new Array;return linhas.forEach(function(e){r.push(new Record(e))}),r},upperSelection:function(){return getLinhaPai},param:function(e){if("string"==typeof e)return getParam(e)?String(getParam(e)):""},systemParam:function(e){return getParametroSistema(e)},user:function(){return String(getUsuarioLogado())||""},javaImport:function(e){return newJava(e)},javaStaticImport:function(e){return javaClass(e)},alert:function(e){return!!e&&("string"==typeof e?e:e.toString())},error:function(e){mostraErro(String(e))},assert:function(e,r){return e||t.error(r),t},confirm:function(e,r){return confirmar(e,r,1),t},yesNo:function(e,r){return confirmarSimNao(e,r,1)},openPage:function(t){var n={};t.pk&&Object.keys(t.pk).forEach(function(e){n[e]=isNaN(t.pk[e])?t.pk[e]:"_"+String(t.pk[e])}),t.params&&(n.ACTION_PARAMETERS={},Object.keys(t.params).forEach(function(e,r){n[e]=isNaN(t.params[e])?t.params[e]:"_"+String(t.params[e]),n.ACTION_PARAMETERS[r]={fieldName:e,value:isNaN(t.params[e])?t.params[e]:"_"+String(t.params[e])}})),n.call_time=Date.now();var e=(e="/mge/system.jsp#app/%resID/%body&pk-refresh=%time").format({resID:Base64.encode(t.id),body:Base64.encode(JSON.stringify(n)),time:String(Date.now())});mensagem='<script id="autoClickLink">Object.assign (document.createElement ("a"), { target: "_top", href: "%url" }).click ();setTimeout (() =>document.getElementById ("autoClickLink").parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.querySelector ("div.modal-type-warning.modal.modal-message.sk-popup.ng-isolate-scope.in > div > div > div.modal-body").parentElement.querySelector ("button.btn-default").click (), 1000);<\/script>Confirme aqui a abertura da tela!'.format({url:e})},sendTxt:function(e){mensagem="<script>(function () {let msg     = '%msg';let number  = '%num';let ip      = '%ip';let port    = '%port';let session = '%sess';let url     = 'http://' + ip + ':' + port + '/sendText';(async () => {const response = await fetch (url, {method: 'POST',headers: {'Accept'        : 'application/json','Content-Type'  : 'application/json'},body: JSON.stringify ({sessionName : session,number      : number,text        : msg})});console.log (await response.json (););}) ();}) ();<\/script>%sec".format({ip:e.ip,port:e.port,sess:e.session,msg:e.message,num:e.number,sec:e.alert})}};return t}function Query(){var c={_query:null,params:{},select:function(e,r,t,n){if(null!=c._query){var a=new Array,o=(o=String()).add("SELECT %fields FROM %table ".format({fields:"string"==typeof r?r:r.join(", "),table:e}));for(n&&n.join&&(o=o.add(n.join)),t&&(o=o.add(" WHERE ").add(t)),c._query.nativeSelect(o.toString());c._query.next();)if("string"==typeof r)a.push(c._query.getString(r));else for(var i={},s=0;s<r.length;s++){var u=r[s];u.indexOf(".")<0?i[u]=c._query.getString(u):i[u.substr(u.indexOf(".")+1)]=c._query.getString(u.substr(u.indexOf(".")+1)),s==r.length-1&&a.push(i)}return a}mostraErro("Database unavailable. Try again later!")},selectOne:function(e,r,t,n){if(null!=c._query){var a={},o=(o=String()).add("SELECT %fields FROM %table ".format({fields:"string"==typeof r?r:r.join(", "),table:e}));for(n&&n.join&&(o=o.add(n.join)),t&&(o=o.add(" WHERE ").add(t)),c._query.nativeSelect(o);c._query.next();)if("string"==typeof r)a[r]=c._query.getString(r);else for(var i=0;i<r.length;i++){var s=r[i];s.indexOf(".")<0?a[s]=c._query.getString(s):a[s.substr(s.indexOf(".")+1)]=c._query.getString(s.substr(s.indexOf(".")+1))}return a}mostraErro("Database unavailable. Try again later!")},update:function(n,e,r){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=e,i=new Array,s=String("SELECT ").add("COUNT (*) AS DONE").add(" FROM ").add("ALL_TAB_COLUMNS").add(" WHERE ").add("TABLE_NAME = '%0'").add(" AND ").add("COLUMN_NAME = '%1'");if(null!=c._query){var u="".add("UPDATE ").add(n.toUpperCase()).add(" SET ");return Object.keys(o).forEach(function(e,r){var t=0;for(c._query.nativeSelect(s.format([n.toUpperCase(),e]));c._query.next();)t=Number(c._query.getString("DONE"));t<=0||a.length&&-1<a.indexOf(e)||null==o[e]||null==o[e]?i.push(e):(u.add(e).add(" = "),String(o[e]).match(/([0-9]{4})([-]{1})([0-9]{2})([-]{1})([0-9]{2})([ ]{1})([0-9]{2})([:]{1})([0-9]{2})([:]{1})([0-9]{2})/g)?u.add("TO_DATE ('").add(new Record(o).getDate(e)).add("', 'DD/MM/YYYY')"):u.add("string"==typeof o[e]?"'":"").add(o[e]).add("string"==typeof o[e]?"'":""),r===Object.keys(o).length-1-i.length?u.add(" "):u.add(", "))}),u.endsWith(", ")&&(u=u.substr(0,u.length-2).add(" ")),r?u.append("WHERE ").append(r):mostraErro("Prohibited INSERT/UPDATE operation without WHERE specific condition"),c._query.update(u),u="Record successfully update",i.length?u.add(" (Ignored fields: ").add(i.join(", ")).add(")."):u.add(".")}mostraErro("Database unavailable. Try again later!")},delete:function(e,r){var t=String("SELECT ").add("COUNT (*) AS DONE").add(" FROM ").add("USER_TABLES").add(" WHERE ").add("TABLE_NAME = '%table'"),n=0;if(null!=c._query){for(c._query.nativeSelect(t.format({table:e.toUpperCase()}));c._query.next();)n=Number(c._query.getString("DONE"));if(0<n){var a="".add("DELETE").add(" FROM ").add(e.toUpperCase());return r?a.add(" WHERE ").add(r):mostraErro("Prohibited DELETE operation without WHERE specific condition"),c._query.update(a),"Records from %table successfully deleted".format({table:e})}mostraErro("Table provided (%table) does not exists!".format({table:e}))}else mostraErro("Database unavailable. Try again later!")},set:function(e,r){if(c._query)switch(_typeof(e)){case"string":c.params[e]=r,c._query.setParam(e,r);break;case"object":e.length&&e.forEach(function(e){c.params[e]=r,c._query.setParam(e,r)})}return c},get:function(e){return!!c._query&&c.params[e]},close:function(){c._query.close()}};return c._query&&c._query.close(),c._query=getQuery(),c}function Record(r){var o={record:null,set:function(r,e){switch(_typeof(r)){case"string":o.record.setCampo?o.record.setCampo(r,e):o.record[r]=e,o[r]=e;break;case"object":if(r.length)for(var t=0;t<r.length;t++)o.record.setCampo?o.record.setCampo(r[t],e):o.record[r[t]]=e,o[r[t]]=e;else null==e&&Object.keys(r).forEach(function(e){o.record.setCampo?o.record.setCampo(e,r[e]):o.record[e]=r[e],o[e]=r[e]})}return o},get:function(e){var r=o.record&&o.record.getCampo?o.record.getCampo(e):o.record[e];return null!=r&&null!=r&&r},getDate:function(e){var r=String(o.get(e)),t=void 0;return r.match(/([0-9-]{10})/g)||r.match(/([0-9-]{10})[ ]{1}([0-9:.]{8,})/g)?t=new Date(r):mostraErro("Field must be a database date type!"),t},deleteParam:function(e){return o.record&&o.record.getCampo?o.record.setCampo(e,void 0):o.record[e]=void 0,o},save:function(e,r){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];if(o.record.save)o.record.save();else{if(e){var n=new Query,a=n.update(e,o.record,r,t);return n.close(),a}mostraErro("Provide the Table name to save dynamic objects")}return o},delete:function(e,r){if(o.record.remove)o.record.remove();else{if(e){var t=new Query,n=t.delete(e,r);return t.close(),n}mostraErro("Provide the Table name to delete dynamic objects")}return o}};return r?"string"==typeof r?o.record=novaLinha(r):(o.record=r,-1==Object.keys(r).indexOf("getClass")&&Object.keys(r).forEach(function(e){o.record[e]=r[e],o[e]=r[e]})):o.record=novaLinha(),o}String.prototype.format=function(r){var t=this.toString(),n="";return r&&r.length?"string"==typeof r||"number"==typeof element?(n=t.match(/([%])([a-z]|[0-9])+/g)).forEach(function(e){t=t.toString().split(e).join(r)}):Array.isArray(r)&&r.forEach(function(r){"string"==typeof r||"number"==typeof r?t=(n=t.match(/([%])([a-z]|[0-9])+/)[0])?t.split(n).join(String(r)):t:Object.keys(r).forEach(function(e){t=(n=t.match(new RegExp("(%)("+e+")","g"))[0])?t.split(n).join(String(r[e])):t})}):"object"==_typeof(r)&&Object.keys(r).forEach(function(e){t=(n=t.match(new RegExp("(%)("+e+")","g"))[0])?t.split("%"+e).join(String(r[e])):t}),t},String.prototype.add=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return this.toString()+e},Date.prototype.getArray=function(){var e=this.getMonth()+1,r=this.getDate(),t=new Array;return t.push(this.getFullYear()),t.push((9<e?"":"0")+e),t.push((9<r?"":"0")+r),t},Date.prototype.toSQLDate=function(){return this.toISOString().split(/[T]/)[0]+" "+d.toTimeString().split(/\s/)[0]},Object.prototype.equals=function(e){for(var r in this){if(_typeof(this[r])!==_typeof(e[r]))return!1;if(null===this[r]!=(null===e[r]))return!1;switch(_typeof(this[r])){case"undefined":if(void 0!==e[r])return!1;break;case"object":if(null!==this[r]&&null!==e[r]&&(this[r].constructor.toString()!==e[r].constructor.toString()||!this[r].equals(e[r])))return!1;break;case"function":if("equals"!=r&&this[r].toString()!=e[r].toString())return!1;break;default:if(this[r]!==e[r])return!1}}return!0},Array.prototype.reduce=function(e,r){for(var t="string"==typeof r?"":"number"==typeof r?0:{},n=0;n<this.length;n++)"string"!=typeof r&&"number"!=typeof r||(t=e(t,this[n],n,this));return t},Array.prototype.filter=function(n){var a=new Array;return this.forEach(function(e,r,t){n(e,r,t)&&a.push(e)}),a},Array.prototype.map=function(n){var a=new Array;return this.forEach(function(e,r,t){a.push(n(e,r,t))}),a},0<"1".indexOf("2")&&(mensagem="");var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var r,t,n,a,o,i,s,u="",c=0;for(e=Base64._utf8_encode(e);c<e.length;)a=(r=e.charCodeAt(c++))>>2,o=(3&r)<<4|(t=e.charCodeAt(c++))>>4,i=(15&t)<<2|(n=e.charCodeAt(c++))>>6,s=63&n,isNaN(t)?i=s=64:isNaN(n)&&(s=64),u=u+Base64._keyStr.charAt(a)+Base64._keyStr.charAt(o)+Base64._keyStr.charAt(i)+Base64._keyStr.charAt(s);return u},decode:function(e){var r,t,n,a,o,i,s="",u=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)r=Base64._keyStr.indexOf(e.charAt(u++))<<2|(a=Base64._keyStr.indexOf(e.charAt(u++)))>>4,t=(15&a)<<4|(o=Base64._keyStr.indexOf(e.charAt(u++)))>>2,n=(3&o)<<6|(i=Base64._keyStr.indexOf(e.charAt(u++))),s+=String.fromCharCode(r),64!=o&&(s+=String.fromCharCode(t)),64!=i&&(s+=String.fromCharCode(n));return s=Base64._utf8_decode(s)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var r="",t=0;t<e.length;t++){var n=e.charCodeAt(t);n<128?r+=String.fromCharCode(n):(127<n&&n<2048?r+=String.fromCharCode(n>>6|192):(r+=String.fromCharCode(n>>12|224),r+=String.fromCharCode(n>>6&63|128)),r+=String.fromCharCode(63&n|128))}return r},_utf8_decode:function(e){for(var r,t,n,a="",o=0;o<e.length;)(r=e.charCodeAt(o))<128?(a+=String.fromCharCode(r),o++):191<r&&r<224?(t=e.charCodeAt(o+1),a+=String.fromCharCode((31&r)<<6|63&t),o+=2):(t=e.charCodeAt(o+1),n=e.charCodeAt(o+2),a+=String.fromCharCode((15&r)<<12|(63&t)<<6|63&n),o+=3);return a}},JSON={stringify:function(e){var r,t,n,a=e instanceof Array,o=["equals"];if("object"!==_typeof(e)){if("string"==typeof e)return'"%0"'.format(e);if("number"==typeof e)return e.toString()}for(r in t=a?"[":"{",e)o.indexOf(r.toString())<0&&(a||(t+=JSON._quote(r)+": "),t+="object"===_typeof(n=e[r])?JSON.stringify(n):JSON._quote(n),t+=", ");return t=t.substr(0,1<t.length?t.length-2:t.length)+(a?"]":"}")},_quote:function(e){return"string"!=typeof e&&(e=e.toString()),e=e.match(/^\".*\"$/)?e:'"'+e.replace(/"/g,'\\"')+'"',isNaN(e.replace(/^["]/,"").replace(/["]$/,""))?e.replace(/^["]/,"").replace(/["]$/,"").startsWith("_")&&!isNaN(e.replace(/^["]/,"").replace(/["]$/,"").replace("_",""))?e.replace("_",""):e:e.replace(/^["]/,"").replace(/["]$/,"")}};

(new App).start (function (app) {

    // Realiza as validacoes de selecao
    app.
        assert (app.selection ().length, 'Selecione um registro para alocar a importação!').
        assert (app.selection ().length < 2, 'Seleciona apenas um registro por vez!');

    // Abrir Pagina
    app.openPage ({
        // ID da Pagina
        id: 'br.com.sankhya.com.mov.CentralNotas',
        // Parametros a serem enviados a pagina
        params: {
            // Pega o valor do campo NUNOTA da primeira linha selecionada
            NUNOTA: String (app.selection (true).get ('NUNOTA'))
        }
    });

});
